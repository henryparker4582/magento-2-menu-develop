<?php /** @var \Snowdog\Menu\Block\Menu $block */ ?>
<div class="menu__mobile">
    <svg title="icon-arrow-down" class="menu__mobile-icon">
        <use xlink:href="<?= $block->getViewFileUrl('images/icon-sprite.svg#icon-mobile-menu'); ?>"></use>
    </svg>
</div>
<nav class="menu">
    <ul class="menu__list"
        data-mage-init='{ "navigationMenu": {} }'
    >
        <?php
            function renderSubList($_sublist, $_listLevel) {
                echo '<ul class="menu__inner-list menu__inner-list--level' . ($_listLevel + 1) . '">';
                foreach ($_sublist as $_subItem) {
                    $_children = false;
                    $_itemUrl = false;
                    if (!empty($_subItem['children'])) {
                        $_children = true;
                    }

                    if ($_subItem['type'] == 'category') {
                        // here I should use function for render category url buti it's not working in this scope
                        $_itemUrl = 'category' . $_subItem['content'];
                    }
                    elseif ($_subItem['type'] == 'cms_block') {
                        $_itemUrl = false;
                    }
                    else {
                        $_itemUrl = $_subItem['content'];
                    }
                    echo '<li class="menu__inner-item menu__inner-item--level' . $_subItem['level'] . (($_children) ? ' menu__inner-item--parent ': '') . $_subItem['classes'] . '">';

                    if ($_itemUrl) {
                        echo '<a href="' . $_itemUrl . '" class="menu__inner-link">' . $_subItem['title'] . '</a>';
                    }
                    else {
                        // here I should render cms block from its id but it's not wokring in this scope
                        echo 'render cms block with blockId in $_item["content"]';
                    }
                    if ($_children) {
                        renderSublist($_subItem['children'], $_subItem['level']);
                    }
                    echo '</li>';
                }
                echo '</ul>';
        }
        ?>

        <?php $nodesData = $this->getNodesData();?>
        <?php foreach ($nodesData as $_item) : ?>
            <?php
                $_children = false;
                $_itemUrl = false;
                if (!empty($_item['children'])) {
                    $_children = true;
                }

                if ($_item['type'] == 'category') {
                    $_itemUrl = $this->getNodeTypeProvider($_item['type'])->getCategoryUrl($_item['node_id']);
                }
                elseif ($_item['type'] == 'cms_block') {
                    $_itemUrl = false;
                }
                else {
                    $_itemUrl = $_item['content'];
                }

            ?>
            <li class="menu__item <?php if($_children) { echo 'menu__item--parent'; } ?> <?= $_item['classes']; ?>">
                <?php if ($_itemUrl) : ?>
                    <a href="<?= $_itemUrl ?>" class="menu__link">
                        <?= $_item['title']; ?>
                    </a>
                <?php else : ?>
                    <div class="menu__link">
                        <?= $block->getLayout()->createBlock('Magento\Cms\Block\Block')->setBlockId($_item['content'])->toHtml(); ?>
                    </div>
                <?php endif; ?>
                <?php
                    if ($_children) {
                        renderSubList($_item['children'], $_item['level']);
                    }
                ?>
            </li>
        <?php endforeach ?>
    </ul>
    <div class="menu__mobile-bg"></div>
</nav>
