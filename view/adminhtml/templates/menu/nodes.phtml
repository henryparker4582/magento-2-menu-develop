<?php
/** @var $block \Snowdog\Menu\Block\Menu\Edit\Tab\Nodes */
$nodeTypes = [];
foreach ($block->getNodeButtons() as $code => $label) {
    $nodeTypes[$code] = $label;
}
?>
<?php
/** @var \Snowdog\Menu\Block\NodeType\AbstractNode $form */
$fieldData = [];
foreach ($block->getNodeForms() as $form) {
    $fieldData[$form->getNodeType()] = $form->getJsonConfig();
}
?>

<div id="snowdog_menu">
    <snowdog-menu :list="list" :config="config">
        <div style="text-align: center">
            <div class="spinner">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </snowdog-menu>
</div>

<script>
    require(
        [
            "Vue",
            "Vddl",
            "vue-select",
            "vue!Snowdog_Menu/vue/App",
            "vue!Snowdog_Menu/vue/NestedList",
            "vue!Snowdog_Menu/vue/MenuType",
            "vue!Snowdog_Menu/vue/MenuType/Category",
            "vue!Snowdog_Menu/vue/MenuType/CmsPage",
            "vue!Snowdog_Menu/vue/MenuType/CmsBlock",
            "vue!Snowdog_Menu/vue/MenuType/CustomUrl",
            "vue!Snowdog_Menu/vue/FieldType/Simple",
            "vue!Snowdog_Menu/vue/FieldType/Autocomplete"
        ], function (Vue, Vddl, vueSelect) {
            Vue.use(Vddl);
            Vue.component('v-select', vueSelect.VueSelect);
            var app = new Vue({
                el: "#snowdog_menu",
                data: {
                    list: <?= $block->renderNodesJson() ?>,
                    config: {
                        fieldData: <?= json_encode($fieldData) ?>,
                        nodeTypes: <?= json_encode($nodeTypes) ?>,
                        translation: {}
                    }
                }
            });
        });
</script>
